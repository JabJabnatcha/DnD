<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To-Do List — LocalStorage</title>
  <style>
    :root{--bg:#f6f7fb;--card:#ffffff;--accent:#0066ff;--danger:#e74c3c}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial; background:var(--bg); margin:0; padding:32px; display:flex; align-items:center; justify-content:center; min-height:100vh}
    .card{width:100%;max-width:640px;background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(20,24,40,0.08)}
    h1{margin:0 0 12px;font-size:20px}
    form{display:flex;gap:8px}
    input[type="text"]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;font-size:15px}
    button{padding:10px 14px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
    button:active{transform:translateY(1px)}
    ul{list-style:none;padding:0;margin:16px 0 0}
    li{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:8px;border:1px solid #f0f2f5;margin-bottom:8px}
    .text{flex:1;margin-right:12px;word-break:break-word}
    .del{background:transparent;border:none;color:var(--danger);font-weight:700;cursor:pointer;padding:6px 8px;border-radius:6px}
    .del:hover{background:#fff5f5}
    .meta{font-size:12px;color:#758095}
    .empty{color:#9aa4b2;margin-top:12px}
    @media (max-width:420px){body{padding:16px}.card{padding:16px}}
  </style>
</head>
<body>
  <main class="card" role="main">
    <h1>To-Do List (เก็บด้วย LocalStorage)</h1>

    <!-- ฟอร์ม: input + add button -->
    <form id="todo-form" aria-label="เพิ่มงาน">
      <input id="todo-input" type="text" placeholder="พิมพ์งานที่อยากทำ เช่น อ่านหนังสือ" aria-label="งานใหม่" autocomplete="off" />
      <button id="add-btn" type="submit">Add</button>
    </form>

    <!-- แสดงรายการ -->
    <ul id="todo-list" aria-live="polite"></ul>
    <p id="empty-msg" class="empty" hidden>ยังไม่มีงานที่บันทึกไว้ — ลองเพิ่มงานใหม่</p>

    <p class="meta">ข้อมูลจะถูกเก็บใน <code>localStorage</code> ของเบราว์เซอร์ (key: <strong>todo_list_v1</strong>).</p>
  </main>

  <script>
    const STORAGE_KEY = 'todo_list_v1';
    let todos = [];

    function saveToStorage(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(todos));
    }

    function loadFromStorage(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        todos = raw ? JSON.parse(raw) : [];
      }catch(err){
        console.error('ไม่สามารถอ่านจาก localStorage ได้', err);
        todos = [];
      }
    }

    function render(){
      const listEl = document.getElementById('todo-list');
      const emptyMsg = document.getElementById('empty-msg');
      listEl.innerHTML = '';

      if(!todos.length){
        emptyMsg.hidden = false;
        return;
      }

      emptyMsg.hidden = true;

      todos.forEach(task => {
        const li = document.createElement('li');

        const span = document.createElement('div');
        span.className = 'text';
        span.textContent = task.text;

        const delBtn = document.createElement('button');
        delBtn.className = 'del';
        delBtn.setAttribute('aria-label', 'ลบงาน');
        delBtn.textContent = 'X';
        delBtn.addEventListener('click', () => {
          deleteTask(task.id);
        });

        li.appendChild(span);
        li.appendChild(delBtn);
        listEl.appendChild(li);
      });
    }

    function addTask(text){
      const t = text.trim();
      if(!t) return false;

      const task = { id: Date.now(), text: t };
      todos.push(task);
      saveToStorage();
      render();
      return true;
    }

    function deleteTask(id){
      todos = todos.filter(t => t.id !== id);
      saveToStorage();
      render();
    }

    document.getElementById('todo-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const input = document.getElementById('todo-input');
      const added = addTask(input.value);
      if(added) input.value = '';
      input.focus();
    });

    document.getElementById('todo-input').addEventListener('keydown', (e) => {
      if(e.key === 'Escape') e.target.value = '';
    });

    document.addEventListener('DOMContentLoaded', () => {
      loadFromStorage();
      render();
    });

    window.__todo = {
      getAll: () => todos,
      clearAll: () => { todos = []; saveToStorage(); render(); }
    };
  </script>
</body>
</html>
