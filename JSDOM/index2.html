<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Interactive To-Do List (JSDOM Playground)</title>
<style>
:root {
  --bg:#f0f4ff;
  --card:#ffffff;
  --accent:#4f46e5;
  --accent-hover:#6366f1;
  --danger:#ef4444;
  --highlight:#fef3c7;
}
* { box-sizing:border-box; margin:0; padding:0; }
body {
  font-family:'Segoe UI',Roboto,sans-serif;
  background: linear-gradient(135deg,#c3ecff,#d4d1ff);
  display: flex; justify-content: center; padding: 40px;
}
.card {
  width: 100%; max-width: 700px; background: var(--card);
  padding: 32px; border-radius: 20px; box-shadow: 0 12px 35px rgba(0,0,0,0.12);
}
h1 {
  text-align: center; margin-bottom: 24px; font-size: 28px; color: #333;
}
.form-group {
  display: grid; grid-template-columns: 1fr auto;
  gap: 12px; margin-bottom: 12px;
}
input[type=text], input[type=search] {
  padding: 12px; border-radius: 12px; border: 1px solid #ccc; font-size: 16px;
  transition: 0.3s;
}
input[type=text]:focus, input[type=search]:focus {
  border-color: var(--accent); box-shadow:0 0 8px rgba(79,70,229,0.3); outline:none;
}
button {
  padding: 12px 20px; border-radius: 12px; border:none; background: var(--accent);
  color: #fff; font-weight:600; cursor:pointer; transition:0.3s;
}
button:hover { background: var(--accent-hover); }
#filter-input { margin-bottom: 12px; width:100%; }
#undo-btn { margin-bottom: 16px; width:100%; }

#count { font-size:14px; margin-bottom:12px; text-align:right; color:#555; }
#todo-list { list-style:none; padding:0; margin:0; }
li {
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 16px; margin-bottom:12px; border-radius:14px;
  background:linear-gradient(120deg,#d1d5db,#f9fafb);
  border:1px solid #e0e0e0; opacity:0; transform:translateX(-20px);
  animation: fadeIn 0.4s forwards; transition: background 0.3s;
  cursor:pointer;
}
li.highlight { background: var(--highlight); }
li:hover { background: linear-gradient(120deg,#e0e7ff,#f3f4ff); }
.text { flex:1; margin-right:12px; word-break:break-word; }
.del {
  background:transparent; border:none; color:var(--danger);
  font-weight:700; cursor:pointer; padding:6px 10px; border-radius:8px;
  transition:0.3s;
}
.del:hover { background:#fee2e2; }
.meta { font-size:12px; color:#555; margin-top:16px; text-align:center; }
.empty { color:#888; margin-top:12px; text-align:center; font-style:italic; }

@keyframes fadeIn { to { opacity:1; transform:translateX(0); } }
@keyframes fadeOut { to { opacity:0; transform:translateX(20px); } }

@media (max-width:480px){
  .form-group { grid-template-columns: 1fr auto; gap:8px; }
  button { padding:10px 14px; }
}
</style>
</head>
<body>
<main class="card">
<h1>Interactive To-Do List</h1>

<div class="form-group">
  <input id="todo-input" type="text" placeholder="พิมพ์งานที่อยากทำ" autocomplete="off">
  <button type="submit" id="add-btn">Add</button>
</div>

<input id="filter-input" type="search" placeholder="ค้นหางาน...">
<button id="undo-btn">Undo ลบล่าสุด</button>
<div id="count">งานทั้งหมด: 0</div>

<ul id="todo-list" aria-live="polite"></ul>
<p id="empty-msg" class="empty" hidden>ยังไม่มีงานที่บันทึกไว้</p>

<p class="meta">ข้อมูลเก็บใน localStorage (key: todo_list_v1)</p>
</main>

<script>
const STORAGE_KEY='todo_list_v1'; let todos=[]; let lastDeleted=null;

function saveToStorage(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)); }
function loadFromStorage(){ const raw=localStorage.getItem(STORAGE_KEY); todos=raw?JSON.parse(raw):[]; }
function updateCount(){ document.getElementById('count').textContent=`งานทั้งหมด: ${todos.length}`; }

function render(filter=''){
  const listEl=document.getElementById('todo-list');
  const emptyMsg=document.getElementById('empty-msg');
  listEl.innerHTML='';
  const filtered=todos.filter(t=>t.text.toLowerCase().includes(filter.toLowerCase()));
  if(!filtered.length){ emptyMsg.hidden=false; }
  else {
    emptyMsg.hidden=true;
    filtered.forEach(task=>{
      const li=document.createElement('li'); li.dataset.id=task.id;
      const span=document.createElement('div'); span.className='text'; span.textContent=task.text; li.appendChild(span);
      const delBtn=document.createElement('button'); delBtn.className='del'; delBtn.textContent='X';
      delBtn.addEventListener('click',e=>{e.stopPropagation(); deleteTask(task.id);});
      li.appendChild(delBtn);
      li.addEventListener('click',()=>{li.classList.toggle('highlight');});
      listEl.appendChild(li);
    });
  }
  updateCount();
}

function addTask(text){
  const t=text.trim(); if(!t) return false;
  const task={id:Date.now(), text:t}; todos.push(task); saveToStorage(); render(document.getElementById('filter-input').value); return true;
}

function deleteTask(id){
  const li=document.querySelector(`#todo-list li[data-id='${id}']`);
  if(li){ li.style.animation='fadeOut 0.4s forwards'; lastDeleted=todos.find(t=>t.id===id);
    setTimeout(()=>{ todos=todos.filter(t=>t.id!==id); saveToStorage(); render(document.getElementById('filter-input').value); },400);
  }
}

function undoDelete(){ if(lastDeleted){ todos.push(lastDeleted); lastDeleted=null; saveToStorage(); render(document.getElementById('filter-input').value); } }

document.getElementById('todo-form')?.addEventListener('submit',e=>{e.preventDefault(); const input=document.getElementById('todo-input'); if(addTask(input.value)) input.value=''; input.focus();});
document.getElementById('add-btn').addEventListener('click',()=>{ const input=document.getElementById('todo-input'); if(addTask(input.value)) input.value=''; input.focus();});
document.getElementById('filter-input').addEventListener('input',e=>{ render(e.target.value); });
document.getElementById('undo-btn').addEventListener('click',undoDelete);
document.addEventListener('DOMContentLoaded',()=>{ loadFromStorage(); render(); });

window.__todo={getAll:()=>todos, clearAll:()=>{todos=[];saveToStorage();render();}};
</script>
</body>
</html>
